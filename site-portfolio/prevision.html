<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPAM Analytics - Pr√©visions</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo">CPAM Analytics</h1>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Accueil</a></li>
                <li><a href="depenses.html" class="nav-link">D√©penses Sant√©</a></li>
                <li><a href="actes.html" class="nav-link">Actes M√©dicaux</a></li>
                <li><a href="prevision.html" class="nav-link active">Pr√©visions</a></li>
                <li><a href="fraudes.html" class="nav-link">D√©tection Fraudes</a></li>
                <li><a href="api.html" class="nav-link">API Analytics</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1>üîÆ Pr√©visions et Mod√©lisation</h1>
            <p>Mod√®les pr√©dictifs ARIMA, Prophet et Machine Learning avec analyses interactives</p>
        </div>

        <div class="controls-panel">
            <h3>üîß Configuration du Mod√®le Pr√©dictif</h3>
            <div class="analysis-container">
                <div>
                    <div class="control-group">
                        <label for="model-type">Type de mod√®le:</label>
                        <select id="model-type" onchange="updateModelParams()">
                            <option value="prophet">Prophet (Facebook)</option>
                            <option value="arima">ARIMA (Auto-R√©gressif)</option>
                            <option value="lstm">LSTM (Deep Learning)</option>
                            <option value="rf">Random Forest</option>
                            <option value="ensemble">Ensemble (Combin√©)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="horizon-select">Horizon de pr√©vision:</label>
                        <select id="horizon-select">
                            <option value="3">3 mois</option>
                            <option value="6">6 mois</option>
                            <option value="12" selected>12 mois</option>
                            <option value="24">24 mois</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="confidence-level">Niveau de confiance:</label>
                        <select id="confidence-level">
                            <option value="80">80%</option>
                            <option value="90">90%</option>
                            <option value="95" selected>95%</option>
                            <option value="99">99%</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="lancerPrevision()">üöÄ Lancer Pr√©vision</button>
                        <button class="btn btn-secondary" onclick="executeProphetScript()">üìä Prophet</button>
                        <button class="btn btn-warning" onclick="executeArimaScript()">üìà ARIMA</button>
                    </div>
                    
                    <div class="control-group">
                        <label>Param√®tres Prophet:</label>
                        <input type="range" id="changepoint-prior" min="0.001" max="0.5" step="0.001" value="0.05">
                        <small>Changepoint Prior: <span id="changepoint-value">0.05</span></small>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-container">
            <div class="chart-container">
                <h3>üìà Pr√©vision des D√©penses de Sant√©</h3>
                <div id="chart-forecast" style="height: 400px;"></div>
            </div>
            
            <div class="chart-container">
                <h3>‚öñÔ∏è Comparaison des Mod√®les</h3>
                <div id="chart-comparison" style="height: 400px;"></div>
            </div>
        </div>

        <div class="chart-container">
            <h3>üíª Sortie des Scripts de Mod√©lisation</h3>
            <div id="script-output" class="script-output">
Pr√™t √† ex√©cuter des mod√®les pr√©dictifs...

üìä Mod√®les disponibles:
- Prophet: Mod√®le additif avec saisonnalit√©
- ARIMA: Auto-r√©gression int√©gr√©e et moyennes mobiles
- LSTM: R√©seaux de neurones r√©currents
- Random Forest: Ensemble d'arbres de d√©cision
- Ensemble: Combinaison pond√©r√©e des mod√®les

üéØ M√©triques de performance:
- MAPE: Erreur absolue moyenne en pourcentage
- RMSE: Racine de l'erreur quadratique moyenne
- R¬≤: Coefficient de d√©termination
- AIC/BIC: Crit√®res d'information pour s√©lection
            </div>
        </div>
    </main>

    <script src="assets/main.js"></script>
    <script>
        // Scripts sp√©cifiques aux pr√©visions
        function lancerPrevision() {
            showLoading();
            
            setTimeout(() => {
                generateForecastCharts();
                hideLoading();
                showSuccess('Mod√®le de pr√©vision ex√©cut√© avec succ√®s !');
            }, 3000);
        }

        function updateModelParams() {
            const modelType = document.getElementById('model-type').value;
            const paramsDiv = document.getElementById('model-params');
            
            // Mise √† jour des param√®tres selon le mod√®le s√©lectionn√©
            let paramsHTML = '';
            
            switch(modelType) {
                case 'prophet':
                    paramsHTML = `
                        <h4>Param√®tres Prophet</h4>
                        <div class="params-grid">
                            <div class="param-group">
                                <label>Saisonnalit√©</label>
                                <select><option>Automatique</option></select>
                            </div>
                        </div>
                    `;
                    break;
                case 'arima':
                    paramsHTML = `
                        <h4>Param√®tres ARIMA</h4>
                        <div class="params-grid">
                            <div class="param-group">
                                <label>Auto-s√©lection</label>
                                <input type="checkbox" checked>
                            </div>
                        </div>
                    `;
                    break;
            }
            
            paramsDiv.innerHTML = paramsHTML;
        }

        function generateForecastCharts() {
            // Graphique principal de pr√©vision
            const dates = [];
            const historique = [];
            const prevision = [];
            const confiance_inf = [];
            const confiance_sup = [];
            
            // Donn√©es historiques (2 ans)
            for(let i = 24; i >= 0; i--) {
                const date = new Date();
                date.setMonth(date.getMonth() - i);
                dates.push(date.toISOString().substr(0, 7));
                if(i > 12) {
                    historique.push(10000 + Math.sin(i/6) * 1000 + Math.random() * 500);
                    prevision.push(null);
                    confiance_inf.push(null);
                    confiance_sup.push(null);
                } else {
                    historique.push(null);
                    const base = 10500 + i * 50;
                    prevision.push(base);
                    confiance_inf.push(base - 300);
                    confiance_sup.push(base + 300);
                }
            }

            const forecastData = [
                {
                    x: dates,
                    y: historique,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Donn√©es historiques',
                    line: { color: '#3498db', width: 3 }
                },
                {
                    x: dates,
                    y: prevision,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Pr√©vision Prophet',
                    line: { color: '#e74c3c', width: 3, dash: 'dash' }
                },
                {
                    x: dates,
                    y: confiance_sup,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'IC 95% sup',
                    line: { color: 'rgba(231, 76, 60, 0.3)' },
                    showlegend: false
                },
                {
                    x: dates,
                    y: confiance_inf,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'IC 95%',
                    fill: 'tonexty',
                    fillcolor: 'rgba(231, 76, 60, 0.2)',
                    line: { color: 'rgba(231, 76, 60, 0.3)' }
                }
            ];

            const forecastLayout = {
                title: 'Pr√©vision des D√©penses de Sant√© - Mod√®le Prophet',
                xaxis: { title: 'Date' },
                yaxis: { title: 'D√©penses (K‚Ç¨)' },
                showlegend: true
            };

            Plotly.newPlot('chart-forecast', forecastData, forecastLayout, {responsive: true});

            // Comparaison des mod√®les
            const comparisonData = [{
                x: ['ARIMA', 'Prophet', 'LSTM', 'Random Forest', 'Ensemble'],
                y: [5.8, 4.7, 6.2, 7.1, 4.3],
                type: 'bar',
                marker: { color: ['#3498db', '#e74c3c', '#f39c12', '#27ae60', '#9b59b6'] },
                name: 'MAPE (%)'
            }];

            const comparisonLayout = {
                title: 'Erreur Moyenne par Mod√®le (MAPE)',
                yaxis: { title: 'MAPE (%)' }
            };

            Plotly.newPlot('chart-comparison', comparisonData, comparisonLayout, {responsive: true});

            // M√©triques de performance
            const performanceData = [{
                r: [94.7, 92.3, 89.1, 87.5],
                theta: ['Pr√©cision', 'Rappel', 'F1-Score', 'AUC'],
                type: 'scatterpolar',
                fill: 'toself',
                name: 'Prophet'
            }];

            const performanceLayout = {
                title: 'Radar de Performance - Mod√®le Prophet',
                polar: {
                    radialaxis: { visible: true, range: [0, 100] }
                }
            };

            Plotly.newPlot('chart-performance', performanceData, performanceLayout, {responsive: true});
        }

        function executeProphetScript() {
            updateExecutionStatus('prophet-status', 'Initialisation Prophet...');
            
            setTimeout(() => {
                updateExecutionStatus('prophet-status', 'Entra√Ænement du mod√®le...');
                setTimeout(() => {
                    updateExecutionStatus('prophet-status', 'G√©n√©ration des pr√©visions...');
                    setTimeout(() => {
                        updateExecutionStatus('prophet-status', 'Termin√© avec succ√®s', 'success');
                        showSuccess('Mod√®le Prophet ex√©cut√© avec succ√®s !');
                    }, 1000);
                }, 1500);
            }, 1000);
        }

        function executeArimaScript() {
            updateExecutionStatus('arima-status', 'Tests de stationnarit√©...');
            
            setTimeout(() => {
                updateExecutionStatus('arima-status', 'S√©lection des param√®tres...');
                setTimeout(() => {
                    updateExecutionStatus('arima-status', 'Termin√© avec succ√®s', 'success');
                    showSuccess('Mod√®le ARIMA ex√©cut√© avec succ√®s !');
                }, 2000);
            }, 1500);
        }

        function executeMLScript() {
            updateExecutionStatus('ml-status', 'Entra√Ænement ensemble ML...');
            
            setTimeout(() => {
                updateExecutionStatus('ml-status', 'Termin√© avec succ√®s', 'success');
                showSuccess('Mod√®les ML ex√©cut√©s avec succ√®s !');
            }, 2500);
        }

        function updateExecutionStatus(elementId, text, className = 'executing') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `execution-status ${className}`;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            generateForecastCharts();
        });
    </script>
</body>
</html>
