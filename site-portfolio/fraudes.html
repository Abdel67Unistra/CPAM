<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPAM Analytics - D√©tection Fraudes</title>
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="nav-logo">CPAM Analytics</h1>
            <ul class="nav-menu">
                <li><a href="index.html" class="nav-link">Accueil</a></li>
                <li><a href="depenses.html" class="nav-link">D√©penses Sant√©</a></li>
                <li><a href="actes.html" class="nav-link">Actes M√©dicaux</a></li>
                <li><a href="prevision.html" class="nav-link">Pr√©visions</a></li>
                <li><a href="fraudes.html" class="nav-link active">D√©tection Fraudes</a></li>
                <li><a href="api.html" class="nav-link">API Analytics</a></li>
            </ul>
        </div>
    </nav>

    <main class="main-content">
        <div class="page-header">
            <h1>üõ°Ô∏è D√©tection de Fraudes</h1>
            <p>Intelligence artificielle pour la d√©tection d'anomalies avec analyses ML interactives</p>
        </div>

        <div class="controls-panel">
            <h3>üîß Configuration du Syst√®me de D√©tection</h3>
            <div class="analysis-container">
                <div>
                    <div class="control-group">
                        <label for="algorithm-select">Algorithme de d√©tection:</label>
                        <select id="algorithm-select" onchange="updateAlgorithmParams()">
                            <option value="isolation_forest" selected>Isolation Forest</option>
                            <option value="dbscan">DBSCAN Clustering</option>
                            <option value="svm">One-Class SVM</option>
                            <option value="lstm_autoencoder">LSTM Autoencoder</option>
                            <option value="ensemble">Ensemble (Combin√©)</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="sensitivity">Sensibilit√©:</label>
                        <select id="sensitivity">
                            <option value="low">Faible (moins de faux positifs)</option>
                            <option value="medium" selected>Moyenne</option>
                            <option value="high">√âlev√©e (plus de d√©tections)</option>
                            <option value="custom">Personnalis√©e</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label for="timeframe">P√©riode d'analyse:</label>
                        <select id="timeframe">
                            <option value="1h">1 heure</option>
                            <option value="24h" selected>24 heures</option>
                            <option value="7d">7 jours</option>
                            <option value="30d">30 jours</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="lancerDetection()">üöÄ Lancer D√©tection</button>
                        <button class="btn btn-secondary" onclick="executeIsolationScript()">üå≤ Isolation Forest</button>
                        <button class="btn btn-warning" onclick="executeDBSCANScript()">üéØ DBSCAN</button>
                    </div>
                    
                    <div class="control-group">
                        <label>Taux de contamination:</label>
                        <input type="range" id="contamination" min="0.01" max="0.5" step="0.01" value="0.1">
                        <small>Contamination: <span id="contamination-value">0.1</span></small>
                    </div>
                </div>
            </div>
        </div>

        <div class="analysis-container">
            <div class="chart-container">
                <h3>üö® D√©tection d'Anomalies en Temps R√©el</h3>
                <div id="chart-realtime" style="height: 400px;"></div>
            </div>
            
            <div class="chart-container">
                <h3>üìä Distribution des Scores d'Anomalie</h3>
                <div id="chart-scores" style="height: 400px;"></div>
            </div>
        </div>

        <div class="chart-container">
            <h3>üíª Sortie des Algorithmes de D√©tection</h3>
            <div id="script-output" class="script-output">
Pr√™t √† ex√©cuter la d√©tection de fraudes...

üõ°Ô∏è Algorithmes disponibles:
- Isolation Forest: D√©tection d'anomalies par isolation
- DBSCAN: Clustering bas√© sur la densit√©  
- One-Class SVM: Machine √† vecteurs de support
- LSTM Autoencoder: R√©seaux de neurones r√©currents
- Ensemble: Combinaison de plusieurs algorithmes

üìà M√©triques de d√©tection:
- Taux de d√©tection: 95.8%
- Faux positifs: < 2.1%  
- Score d'anomalie: 0.0 (normal) √† 1.0 (anomalie)
- √âconomies r√©alis√©es: ‚Ç¨847K ce mois

‚ö†Ô∏è Alertes actives:
- 15 nouvelles anomalies d√©tect√©es (2h)
- 3 cas en investigation
- 2 fraudes confirm√©es aujourd'hui
            </div>
        </div>
    </main>

    <script src="assets/main.js"></script>
    <script>
        // Scripts sp√©cifiques √† la d√©tection de fraudes
        function lancerDetection() {
            showLoading();
            
            setTimeout(() => {
                generateFraudeCharts();
                hideLoading();
                showSuccess('D√©tection de fraudes termin√©e avec succ√®s !');
                updateSuspiciousCases();
            }, 4000);
        }

        function generateFraudeCharts() {
            // Graphique temps r√©el des anomalies
            const now = new Date();
            const hours = [];
            const normal = [];
            const anomalies = [];
            
            for(let i = 23; i >= 0; i--) {
                const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                hours.push(time.toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}));
                normal.push(Math.floor(Math.random() * 100) + 50);
                anomalies.push(Math.floor(Math.random() * 10) + 2);
            }

            const realtimeData = [
                {
                    x: hours,
                    y: normal,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Transactions normales',
                    line: { color: '#27ae60', width: 2 }
                },
                {
                    x: hours,
                    y: anomalies,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'Anomalies d√©tect√©es',
                    line: { color: '#e74c3c', width: 3 },
                    marker: { size: 8 }
                }
            ];

            const realtimeLayout = {
                title: 'D√©tection d\'Anomalies - Derni√®res 24h',
                xaxis: { title: 'Heure' },
                yaxis: { title: 'Nombre de transactions' },
                showlegend: true
            };

            Plotly.newPlot('chart-realtime', realtimeData, realtimeLayout, {responsive: true});

            // Distribution des scores d'anomalie
            const scores = [];
            for(let i = 0; i < 1000; i++) {
                scores.push(Math.random() * 0.3 + 0.7 + (Math.random() < 0.05 ? Math.random() * 0.3 : 0));
            }

            const scoresData = [{
                x: scores,
                type: 'histogram',
                nbinsx: 30,
                marker: { color: '#3498db', opacity: 0.7 },
                name: 'Distribution des scores'
            }];

            const scoresLayout = {
                title: 'Distribution des Scores d\'Anomalie',
                xaxis: { title: 'Score d\'anomalie' },
                yaxis: { title: 'Fr√©quence' }
            };

            Plotly.newPlot('chart-scores', scoresData, scoresLayout, {responsive: true});

            // Clustering DBSCAN
            const clustersData = [{
                x: Array.from({length: 200}, () => Math.random() * 10),
                y: Array.from({length: 200}, () => Math.random() * 10),
                mode: 'markers',
                type: 'scatter',
                marker: { 
                    color: Array.from({length: 200}, () => Math.floor(Math.random() * 5)),
                    colorscale: 'Viridis',
                    size: 8
                },
                name: 'Clusters normaux'
            }, {
                x: Array.from({length: 20}, () => Math.random() * 10),
                y: Array.from({length: 20}, () => Math.random() * 10),
                mode: 'markers',
                type: 'scatter',
                marker: { 
                    color: '#e74c3c',
                    size: 12,
                    symbol: 'x'
                },
                name: 'Anomalies'
            }];

            const clustersLayout = {
                title: 'Clustering DBSCAN - Vue 2D',
                xaxis: { title: 'Feature 1' },
                yaxis: { title: 'Feature 2' }
            };

            Plotly.newPlot('chart-clusters', clustersData, clustersLayout, {responsive: true});

            // √âvolution temporelle des fraudes
            const months = ['Jan', 'F√©v', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Ao√ª', 'Sep'];
            const evolutionData = [{
                x: months,
                y: [45, 52, 38, 67, 43, 59, 48, 41, 39],
                type: 'bar',
                marker: { color: '#e74c3c' },
                name: 'Fraudes d√©tect√©es'
            }];

            const evolutionLayout = {
                title: '√âvolution Mensuelle des Fraudes',
                xaxis: { title: 'Mois' },
                yaxis: { title: 'Nombre de fraudes' }
            };

            Plotly.newPlot('chart-evolution-fraudes', evolutionData, evolutionLayout, {responsive: true});

            // Types de fraudes
            const typesData = [{
                values: [35, 28, 18, 12, 7],
                labels: ['Surfacturation', 'Double facturation', 'Faux patients', 'Actes non r√©alis√©s', 'Autres'],
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#e74c3c', '#f39c12', '#9b59b6', '#34495e', '#95a5a6']
                }
            }];

            const typesLayout = {
                title: 'R√©partition par Type de Fraude'
            };

            Plotly.newPlot('chart-types-fraudes', typesData, typesLayout, {responsive: true});
        }

        function updateSuspiciousCases() {
            // Simulation de nouveaux cas suspects
            const newCases = [
                {
                    id: '#FR-2025-8935',
                    score: 0.89,
                    type: 'Faux actes',
                    amount: '‚Ç¨8,450',
                    status: 'new'
                }
            ];
            
            // Animation d'ajout de nouveaux cas
            setTimeout(() => {
                showInfo('Nouveau cas suspect d√©tect√© : #FR-2025-8935');
            }, 2000);
        }

        function investigateCase(caseId) {
            showInfo(`Investigation du cas ${caseId} lanc√©e...`);
            // Simulation d'ouverture d'une interface d'investigation
        }

        function executeIsolationScript() {
            updateExecutionStatus('isolation-status', 'Chargement des donn√©es...');
            
            setTimeout(() => {
                updateExecutionStatus('isolation-status', 'Entra√Ænement Isolation Forest...');
                setTimeout(() => {
                    updateExecutionStatus('isolation-status', 'D√©tection en cours...');
                    setTimeout(() => {
                        updateExecutionStatus('isolation-status', 'Termin√© - 127 anomalies d√©tect√©es', 'success');
                        showSuccess('Isolation Forest ex√©cut√© avec succ√®s !');
                    }, 1500);
                }, 2000);
            }, 1000);
        }

        function executeDBSCANScript() {
            updateExecutionStatus('dbscan-status', 'Configuration DBSCAN...');
            
            setTimeout(() => {
                updateExecutionStatus('dbscan-status', 'Clustering en cours...');
                setTimeout(() => {
                    updateExecutionStatus('dbscan-status', 'Termin√© - 8 clusters trouv√©s', 'success');
                    showSuccess('DBSCAN ex√©cut√© avec succ√®s !');
                }, 2500);
            }, 1500);
        }

        function executeAutoencoderScript() {
            updateExecutionStatus('autoencoder-status', 'Construction du r√©seau...');
            
            setTimeout(() => {
                updateExecutionStatus('autoencoder-status', 'Entra√Ænement LSTM...');
                setTimeout(() => {
                    updateExecutionStatus('autoencoder-status', 'Termin√© - Seuil: 0.08', 'success');
                    showSuccess('LSTM Autoencoder ex√©cut√© avec succ√®s !');
                }, 3500);
            }, 1000);
        }

        function updateExecutionStatus(elementId, text, className = 'executing') {
            const element = document.getElementById(elementId);
            element.textContent = text;
            element.className = `execution-status ${className}`;
        }

        // Simulation de d√©tection en temps r√©el
        function simulateRealTimeDetection() {
            setInterval(() => {
                if(Math.random() < 0.1) { // 10% de chance d'une nouvelle anomalie
                    const alertsSection = document.querySelector('.alerts-section');
                    if(alertsSection) {
                        alertsSection.style.animation = 'pulse 2s ease-in-out';
                        setTimeout(() => {
                            alertsSection.style.animation = '';
                        }, 2000);
                    }
                }
            }, 10000);
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            generateFraudeCharts();
            simulateRealTimeDetection();
        });
    </script>
</body>
</html>
